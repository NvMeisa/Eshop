# Eshop API

Масштабируемое и поддерживаемое API приложение для интернет-магазина Eshop.

## Особенности

- **Версионирование**: Поддержка нескольких версий API (v1, v2)
- **Масштабируемость**: Модульная архитектура для легкого расширения
- **Производительность**: Оптимизированные запросы с select_related и prefetch_related
- **Безопасность**: Множественные методы аутентификации
- **Документация**: Автоматическая генерация документации с drf-spectacular
- **Тестирование**: Полный набор тестов для всех эндпоинтов
- **Мониторинг**: Логирование и метрики для всех API запросов


## Структура проекта

```
api/
├── __init__.py
├── apps.py                 # Конфигурация приложения
├── settings.py            # Настройки API
├── urls.py               # Главные URL маршруты
├── middleware.py         # Middleware для API
├── tests.py              # Тесты API
├── README.md             # Этот файл
├── common/               # Общие компоненты
│   ├── __init__.py
│   └── base.py          # Базовые классы
├── v1/                   # API версии 1
│   ├── __init__.py
│   ├── views.py         # ViewSet для v1
│   └── urls.py          # URL маршруты для v1
├── v2/                   # API версии 2 (будущее)
│   └── __init__.py
├── authentication/       # Система аутентификации
│   └── __init__.py
├── permissions/          # Система разрешений
│   └── __init__.py
├── filters/              # Система фильтрации
│   └── __init__.py
├── pagination/           # Система пагинации
│   └── __init__.py
├── throttling/           # Система ограничений
│   └── __init__.py
└── versioning/           # Система версионирования
│   └── __init__.py
```

## Установка и настройка

### 1. Добавьте API приложение в INSTALLED_APPS

```python
# settings.py
INSTALLED_APPS = [
    # ... другие приложения
    'api.apps.ApiConfig',
    'drf_spectacular',  # Автоматическая документация API
]
```

### 2. Добавьте URL маршруты API

```python
# eshop/urls.py
from django.urls import include, path

urlpatterns = [
    # ... другие URL
    path('api/', include('api.urls', namespace='api')),
]
```

### 3. Настройте drf-spectacular

```python
# settings.py
REST_FRAMEWORK = {
    # ... другие настройки
    'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema',
}

SPECTACULAR_SETTINGS = {
    'TITLE': 'Eshop API',
    'DESCRIPTION': 'API для интернет-магазина Eshop',
    'VERSION': '1.0.0',
    'TAGS': [
        {'name': 'categories', 'description': 'Управление категориями товаров'},
        {'name': 'products', 'description': 'Управление товарами'},
        {'name': 'carts', 'description': 'Управление корзиной'},
        {'name': 'cart-items', 'description': 'Управление товарами в корзине'},
        {'name': 'profile', 'description': 'Профиль пользователя'},
    ],
}
```

## Использование

### Базовые эндпоинты

- **Категории**: `/api/v1/categories/`
- **Товары**: `/api/v1/products/`
- **Корзина**: `/api/v1/carts/`
- **Товары в корзине**: `/api/v1/cart-items/`
- **Профиль пользователя**: `/api/v1/profile/`

### Примеры запросов

#### Получение списка товаров
```bash
GET /api/v1/products/?search=phone&page=1&page_size=10
```

#### Добавление товара в корзину
```bash
POST /api/v1/carts/{cart_id}/add_item/
{
    "product_id": 1,
    "quantity": 2
}
```

#### Получение профиля пользователя
```bash
GET /api/v1/profile/me/
Authorization: Token {your_token}
```

## Аутентификация

API поддерживает несколько методов аутентификации:

1. **Session Authentication** - для веб-интерфейса
2. **Token Authentication** - для мобильных приложений
3. **JWT Authentication** - для SPA и мобильных приложений
4. **API Key Authentication** - для сервис-сервисного взаимодействия

## Пагинация

По умолчанию используется стандартная пагинация:
- Размер страницы: 20
- Максимальный размер: 100
- Параметр: `page_size`

## Фильтрация и поиск

Поддерживаются различные типы фильтров:
- Поиск по тексту
- Фильтрация по категории
- Фильтрация по цене
- Сортировка по различным полям

## Ограничения скорости

- **Анонимные пользователи**: 100 запросов в час
- **Аутентифицированные пользователи**: 1000 запросов в час

## Тестирование

Запуск тестов:
```bash
python manage.py test api
```

Запуск тестов с покрытием:
```bash
coverage run --source='.' manage.py test api
coverage report
```

## Документация API

API автоматически генерирует документацию с помощью **drf-spectacular**:

- **Swagger UI**: `/api/docs/` - интерактивная документация
- **ReDoc**: `/api/redoc/` - красивая документация в стиле ReDoc
- **OpenAPI Schema**: `/api/schema/` - JSON схема API

Документация генерируется автоматически на основе:
- ViewSet и их методов
- Сериализаторов и их полей
- Фильтров и параметров
- Разрешений и аутентификации

## Мониторинг и логирование

API автоматически логирует:
- Все входящие запросы
- Время выполнения запросов
- Ошибки и исключения
- Метрики производительности

## Расширение API

### Добавление нового эндпоинта

1. Создайте ViewSet в соответствующей версии API
2. Добавьте URL маршрут
3. Напишите тесты
4. Документация сгенерируется автоматически!

### Создание новой версии API

1. Создайте папку `v2/`
2. Скопируйте и адаптируйте ViewSet из v1
3. Добавьте URL маршруты
4. Обновите версионирование

## Производительность

### Оптимизация запросов

- Автоматическое применение `select_related` для связанных полей
- Автоматическое применение `prefetch_related` для обратных связей
- Кэширование часто запрашиваемых данных

### Мониторинг

- Время выполнения запросов
- Количество запросов к базе данных
- Использование памяти
- Ошибки и исключения

## Безопасность

- Валидация входных данных
- Защита от SQL-инъекций
- Ограничение скорости запросов
- Логирование подозрительной активности
- Поддержка CORS

## Поддержка

Для получения поддержки:
- Создайте issue в репозитории
- Обратитесь к команде разработки
- Проверьте документацию API

